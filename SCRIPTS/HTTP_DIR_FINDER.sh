#!/bin/bash

. ENV/general.env

is_gobuster_installed=false
is_dirsearch_installed=false
if command -v gobuster &> /dev/null; then
    is_gobuster_installed=true
else
    echo "gobuster is not installed."
fi
if command -v dirsearch &> /dev/null; then
    is_dirsearch_installed=true
else
    echo "dirsearch is not installed."
fi
if ! $is_gobuster_installed || ! $is_dirsearch_installed; then
    echo "Do you want to install the missing package(s) ? [Y/n]"
    read -r answer
    if [[ $answer =~ ^[Yy]$ ]]; then
        echo "Updating package lists..."
        sudo apt-get update
        if ! $is_gobuster_installed; then
            echo "Installing gobuster..."
            sudo apt-get install -y gobuster
            echo "gobuster installation complete."
        fi
        if ! $is_dirsearch_installed; then
            echo "Installing dirsearch..."
            sudo apt-get install -y dirsearch
            echo "dirsearch installation complete."
        fi
    else
        echo "Skipping installation."
    fi
else
    echo "All required applications are already installed."
fi

FULL_PATH_DATA="${PWD}/${DATA_FOLDER}/$(basename $0)/"
mkdir -p "$FULL_PATH_DATA"

echo "======== Simple dirsearch ========"
dirsearch -u $IP -o $FULL_PATH_DATA/simple_dirsearch.txt # -x 404 --> exclude code 404
echo "======== gobuster wordlist big ========"
gobuster dir -u http://$IP -w $PATH_WORDLIST_BIG -o $FULL_PATH_DATA/gobuster_big.txt
